<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Mini Shop</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
      margin: 0;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      font-size: 16px;
    }
    #products {
      margin-top: 15px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .item {
      background: #d0ebff;
      padding: 15px;
      border-radius: 6px;
      text-align: center;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Добавить товар</h2>
  <input type="text" id="productName" placeholder="Название товара">
  <button onclick="sendProduct()">Добавить</button>

  <h2>Список товаров</h2>
  <div id="products"></div>

  <script>
    let tg = window.Telegram.WebApp;
    tg.expand(); // fullscreen

    // Загружаем товары при старте
    tg.sendData("__get_products__");

    function sendProduct() {
      let name = document.getElementById("productName").value.trim();
      if (name) {
        tg.sendData(name); // отправляем товар
        document.getElementById("productName").value = "";
      }
    }

    // Получаем данные от бота через WebAppQueryResult
    Telegram.WebApp.onEvent("web_app_query_result", (result) => {
      try {
        let data = JSON.parse(result.result);
        renderProducts(data.products);
      } catch (e) {
        console.error("Ошибка парсинга:", e, result);
      }
    });

    function renderProducts(products) {
      let container = document.getElementById("products");
      container.innerHTML = "";
      products.forEach(p => {
        let div = document.createElement("div");
        div.className = "item";
        div.innerText = p.name;
        container.appendChild(div);
      });
    }
  </script>
</body>
</html>
