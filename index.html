<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Mini Shop</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    input, button { padding: 10px; margin: 5px 0; width: 100%; }
    #products { margin-top: 15px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .item { background: #d0ebff; padding: 15px; border-radius: 6px; text-align: center; }
  </style>
</head>
<body>
  <h2>Добавить товар</h2>
  <input type="text" id="productName" placeholder="Название товара">
  <button onclick="sendProduct()">Добавить</button>

  <h2>Список товаров</h2>
  <div id="products"></div>

  <script>
    let tg = window.Telegram.WebApp;
    tg.expand();

    function sendProduct() {
      let name = document.getElementById("productName").value.trim();
      if (name) {
        tg.sendData(name);
        document.getElementById("productName").value = "";
      }
    }

    // ⚡ слушаем ответы от бота
    Telegram.WebApp.onEvent("message", (msg) => {
      try {
        let data = JSON.parse(msg.text.replace(/'/g, '"')); // парсим JSON
        renderProducts(data.products);
      } catch (e) {
        console.error("Ошибка парсинга:", e, msg.text);
      }
    });

    function renderProducts(products) {
      let container = document.getElementById("products");
      container.innerHTML = "";
      products.forEach(p => {
        let div = document.createElement("div");
        div.className = "item";
        div.innerText = p.name;
        container.appendChild(div);
      });
    }
  </script>
</body>
</html>
